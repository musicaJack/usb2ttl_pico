# TTL键盘系统 - USB2TTL Pico项目

## 项目概述

这是一个基于树莓派Pico的TTL键盘输入系统，通过USB2TTL模块接收键盘输入，并在ILI9488 3.5英寸TFT显示屏上提供键盘命令界面和文本编辑功能。

## 版本信息

- **版本**: 2.0.0
- **硬件**: Raspberry Pi Pico + ILI9488 + USB2TTL模块
- **颜色系统**: RGB666原生支持
- **开发语言**: C++17

## 主要功能

### 1. TTL键盘输入
- 通过UART0接收USB2TTL模块的键盘数据
- 支持ASCII字符和控制键
- 支持ANSI转义序列（方向键、功能键等）
- 自动连接检测和超时处理

### 2. 双模式界面
- **命令模式**: 显示键盘命令列表和系统状态
- **编辑模式**: 提供文本编辑功能

### 3. 文本编辑器
- 字符输入和删除
- 换行和制表符支持
- 文件保存功能（F10键）
- 光标位置显示

## 硬件连接

### ILI9488显示屏 (SPI0)
```
Pico Pin  | ILI9488 Pin | 功能
----------|-------------|--------
GPIO 17   | CS          | 片选
GPIO 20   | DC          | 数据/命令
GPIO 15   | RST         | 复位
GPIO 18   | SCK         | 时钟
GPIO 19   | MOSI        | 数据
GPIO 10   | BL          | 背光
3.3V      | VCC         | 电源
GND       | GND         | 地线
```

### TTL键盘 (UART1)
```
Pico Pin  | USB2TTL模块 | 功能
----------|-------------|--------
GPIO 8    | TX          | 发送（未使用）
GPIO 9    | RX          | 接收键盘数据
GND       | GND         | 地线
```

### 状态LED
```
Pico Pin  | 功能
----------|--------
GPIO 25   | 状态指示LED
```

## 软件架构

### 核心类

1. **TTLKeyboard** (`include/usb_keyboard.hpp`)
   - 处理UART1串口通信 (GPIO 8/9)
   - 解析键盘输入数据
   - 提供按键事件回调

2. **ILI9488DisplayAdapter** (`examples/usb2ttl_demo.cpp`)
   - 实现DisplayDriver接口
   - 提供RGB666颜色支持
   - 封装ILI9488驱动功能

3. **TextEditor** (`include/text_editor.hpp`)
   - 文本编辑和显示
   - 光标管理
   - 文件操作

### 应用状态

- **AppState::COMMAND_MODE**: 键盘命令界面
- **AppState::EDIT_MODE**: 文本编辑模式

## 使用说明

### 启动流程

1. 连接硬件（显示屏、USB2TTL模块）
2. 将键盘连接到USB2TTL模块
3. 上电启动，系统显示命令界面

### 键盘命令（命令模式）

| 按键 | 功能 |
|------|------|
| Enter | 进入文本编辑模式 |
| ESC | 清屏并重置 |

### 键盘命令（编辑模式）

| 按键 | 功能 |
|------|------|
| ESC | 返回命令模式 |
| Enter | 换行 |
| Backspace | 删除字符 |
| Tab | 插入4个空格 |
| F10 | 保存文本到文件 |
| 字母/数字 | 输入字符 |

### 状态显示

屏幕底部显示：
- TTL键盘连接状态
- 当前模式（COMMAND/EDIT）
- 系统运行时间
- 光标位置（编辑模式）
- 文件修改状态

## 技术特性

### TTL通信
- **UART实例**: UART1
- **GPIO引脚**: TX=8, RX=9
- **波特率**: 9600 bps
- **数据位**: 8位
- **停止位**: 1位
- **校验位**: 无
- **流控**: 无

### 颜色系统
- **原生格式**: RGB666 (18位)
- **颜色深度**: 262,144种颜色
- **转换支持**: RGB666 ↔ RGB565/RGB888

### 性能优化
- 直接RGB666格式操作
- 优化的清屏和矩形填充
- 智能颜色转换
- 最小化内存拷贝

## 构建说明

### 环境要求
- Pico SDK v1.5.1+
- CMake 3.13+
- GCC ARM工具链

### 构建步骤
```bash
mkdir build
cd build
cmake ..
make -j4
```

### 输出文件
- `usb2ttl_demo.elf` - ELF可执行文件
- `usb2ttl_demo.uf2` - UF2固件文件（用于烧录）

## 内存使用

- **FLASH**: 371,252 B (17.70%)
- **RAM**: 15,224 B (5.81%)

## 故障排除

### 键盘无响应
1. 检查USB2TTL模块连接
2. 确认波特率设置（9600）
3. 检查RX/TX线连接

### 显示异常
1. 检查SPI连接
2. 确认电源供应
3. 检查背光连接

### 编译错误
1. 确认Pico SDK路径
2. 检查CMake版本
3. 验证工具链安装

## 开发说明

### 添加新功能
1. 扩展TTLKeyboard类支持更多按键
2. 在TextEditor中添加新的编辑功能
3. 扩展显示驱动支持更多图形操作

### 调试
- 使用UART输出调试信息
- LED状态指示系统运行状态
- 屏幕状态显示实时信息

## 许可证

本项目遵循开源许可证，具体条款请参考项目根目录的LICENSE文件。

## 更新日志

### v2.0.0 (当前版本)
- 重构为TTL键盘输入系统
- 移除USB HID依赖
- 简化为双模式界面
- 优化RGB666颜色系统
- 改进错误处理和状态显示

### v1.0.0
- 初始USB键盘版本
- 基础显示和编辑功能 